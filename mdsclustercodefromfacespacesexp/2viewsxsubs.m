ElenaAll =[25.0	25.0	7
25.0	30.0	1
25.0	40.0	1
25.0	47.0	2
25.0	63.0	1
25.0	71.0	1
30.0	30.0	7
30.0	40.0	3
30.0	47.0	1
30.0	63.0	1
30.0	71.0	1
40.0	40.0	7
40.0	47.0	2
40.0	63.0	2
40.0	71.0	3
47.0	47.0	7
47.0	63.0	5
47.0	71.0	4
63.0	63.0	7
63.0	71.0	3
71.0	71.0	7
25.30	25.30	7
25.30	30.30	1
25.30	40.30	1
25.30	47.30	1
25.30	63.30	1
25.30	71.30	1
30.30	30.30	7
30.30	40.30	2
30.30	47.30	2
30.30	63.30	1
30.30	71.30	1
40.30	40.30	7
40.30	47.30	1
40.30	63.30	1
40.30	71.30	1
47.30	47.30	7
47.30	63.30	5
47.30	71.30	5
63.30	63.30	7
63.30	71.30	1
71.30	71.30	7
25.60	25.60	7
25.60	30.60	2
25.60	40.60	1
% 25.60	47.60	2
% 25.60	63.60	3
% 25.60	71.60	1
% 30.60	30.60	7
% 30.60	40.60	3
% 30.60	47.60	1
% 30.60	63.60	1
% 30.60	71.60	2
% 40.60	40.60	7
% 40.60	47.60	1
% 40.60	63.60	2
% 40.60	71.60	1
% 47.60	47.60	7
% 47.60	63.60	2
% 47.60	71.60	1
% 63.60	63.60	7
% 63.60	71.60	2
% 71.60	71.60	7
% 25.90	25.90	7
% 25.90	30.90	1
% 25.90	40.90	1
% 25.90	47.90	2
% 25.90	63.90	1
% 25.90	71.90	1
% 30.90	30.90	7
% 30.90	40.90	2
% 30.90	47.90	1
% 30.90	63.90	2
% 30.90	71.90	1
% 40.90	40.90	7
% 40.90	47.90	1
% 40.90	63.90	1
% 40.90	71.90	1
% 47.90	47.90	7
% 47.90	63.90	2
% 47.90	71.90	3
% 63.90	63.90	7
% 63.90	71.90	2
% 71.90	71.90	7]
]
% data format is 
% face1 face2 rating
% all from a single viewpoint

Elena0=[25	25	7.00;
25	30	1.00;
25	40	1.00;
25	47	2.00;
25	63	1.00;
25	71	1.00;
30	30	7.00;
30	40	3.00;
30	47	1.00;
30	63	1.00;
30	71	1.00;
40	40	7.00;
40	47	2.00;
40	63	2.00;
40	71	3.00;
47	47	7.00;
47	63	5.00;
47	71	4.00;
63	63	7.00;
63	71	3.00;
71	71	7.00;]

Elena30=[25	25	7
25	30	1
25	40	1
25	47	1
25	63	1
25	71	1
30	30	7
30	40	2
30	47	2
30	63	1
30	71	1
40	40	7
40	47	1
40	63	1
40	71	1
47	47	7
47	63	5
47	71	5
63	63	7
63	71	1
71	71	7]

Elena60=[25	25	7
25	30	2
25	40	1
25	47	2
25	63	3
25	71	1
30	30	7
30	40	3
30	47	1
30	63	1
30	71	2
40	40	7
40	47	1
40	63	2
40	71	1
47	47	7
47	63	2
47	71	1
63	63	7
63	71	2
71	71	7]

Elena90=[25	25	7
25	30	1
25	40	1
25	47	2
25	63	1
25	71	1
30	30	7
30	40	2
30	47	1
30	63	2
30	71	1
40	40	7
40	47	1
40	63	1
40	71	1
47	47	7
47	63	2
47	71	3
63	63	7
63	71	2
71	71	7]


Erika0 =[25	25	7
25	30	5
25	40	3
25	47	4
25	63	3
25	71	5
30	30	7
30	40	4
30	47	3
30	63	3
30	71	5
40	40	7
40	47	1
40	63	6
40	71	3
47	47	7
47	63	3
47	71	3
63	63	7
63	71	4
71	71	7]

Jayne0 =[25	25	7
25	30	3
25	40	3
25	47	5
25	63	2
25	71	3
30	30	7
30	40	4
30	47	4
30	63	5
30	71	2
40	40	7
40	47	4
40	63	5
40	71	4
47	47	7
47	63	3
47	71	5
63	63	7
63	71	3
71	71	7]

Jayne30=[25	25	7
25	30	4
25	40	5
25	47	3
25	63	2
25	71	3
30	30	7
30	40	3
30	47	3
30	63	2
30	71	3
40	40	7
40	47	5
40	63	4
40	71	3
47	47	7
47	63	3
47	71	4
63	63	7
63	71	4
71	71	7]
Jayne60=[25	25	7
25	30	4
25	40	4
25	47	2
25	63	3
25	71	2
30	30	7
30	40	4
30	47	4
30	63	3
30	71	5
40	40	7
40	47	2
40	63	4
40	71	2
47	47	7
47	63	4
47	71	4
63	63	7
63	71	2
71	71	7]
Jayne90=[25	25	7
25	30	5
25	40	3
25	47	3
25	63	4
25	71	5
30	30	7
30	40	5
30	47	3
30	63	2
30	71	4
40	40	7
40	47	5
40	63	4
40	71	4
47	47	7
47	63	5
47	71	1
63	63	7
63	71	4
71	71	7]

Minkyung0 = [25	25	7
25	30	4
25	40	5
25	47	5
25	63	5
25	71	3
30	30	7
30	40	6
30	47	5
30	63	4
30	71	5
40	40	7
40	47	6
40	63	5
40	71	4
47	47	7
47	63	2
47	71	5
63	63	7
63	71	3
71	71	7]
Minkyung0=[25	25	7
25	30	4
25	40	5
25	47	5
25	63	5
25	71	3
30	30	7
30	40	6
30	47	5
30	63	4
30	71	5
40	40	7
40	47	6
40	63	5
40	71	4
47	47	7
47	63	2
47	71	5
63	63	7
63	71	3
71	71	7]
Minkyung30=[25	25	7
25	30	3
25	40	2
25	47	5
25	63	3
25	71	3
30	30	7
30	40	6
30	47	3
30	63	4
30	71	4
40	40	7
40	47	3
40	63	6
40	71	5
47	47	7
47	63	5
47	71	5
63	63	7
63	71	5
71	71	7]
Minkyung60=[25	25	7
25	30	5
25	40	3
25	47	3
25	63	4
25	71	4
30	30	7
30	40	6
30	47	5
30	63	5
30	71	6
40	40	7
40	47	5
40	63	6
40	71	3
47	47	7
47	63	6
47	71	5
63	63	7
63	71	5
71	71	7]
Minkyung90=[25	25	7
25	30	3
25	40	2
25	47	3
25	63	4
25	71	3
30	30	7
30	40	3
30	47	4
30	63	3
30	71	3
40	40	7
40	47	5
40	63	4
40	71	5
47	47	7
47	63	5
47	71	5
63	63	7
63	71	4
71	71	7]

Omo0 = [25	25	7
25	30	2
25	40	1
25	47	1
25	63	1
25	71	1
30	30	7
30	40	2
30	47	1
30	63	1
30	71	3
40	40	7
40	47	4
40	63	4
40	71	2
47	47	7
47	63	1
47	71	1
63	63	7
63	71	3
71	71	7]

Omo30=[25	25	7.00
25	30	3.00
25	40	1.00
25	47	1.00
25	63	2.00
25	71	1.00
30	30	7.00
30	40	3.00
30	47	2.00
30	63	3.00
30	71	2.00
40	40	7.00
40	47	1.00
40	63	3.00
40	71	1.00
47	47	7.00
47	63	2.00
47	71	3.00
63	63	7.00
63	71	3.00
71	71	7.00]
Omo60=[25	25	7.00
25	30	1.00
25	40	2.00
25	47	2.00
25	63	2.00
25	71	2.00
30	30	7.00
30	40	2.00
30	47	2.00
30	63	3.00
30	71	2.00
40	40	7.00
40	47	2.00
40	63	4.00
40	71	2.00
47	47	7.00
47	63	4.00
47	71	2.00
63	63	7.00
63	71	2.00
71	71	7.00]
Omo90=[25	25	7.00
25	30	1.00
25	40	3.00
25	47	1.00
25	63	5.00
25	71	1.00
30	30	7.00
30	40	4.00
30	47	1.00
30	63	3.00
30	71	2.00
40	40	7.00
40	47	1.00
40	63	1.00
40	71	1.00
47	47	7.00
47	63	1.00
47	71	1.00
63	63	7.00
63	71	2.00
71	71	7.00]

Average0=[25	25	7.00
25	30	2.00
25	40	2.20
25	47	3.40
25	63	1.40
25	71	1.60
30	30	7.00
30	40	2.80
30	47	2.20
30	63	2.00
30	71	1.60
40	40	7.00
40	47	3.20
40	63	3.00
40	71	2.20
47	47	7.00
47	63	2.60
47	71	2.80
63	63	7.00
63	71	2.20
71	71	7.00]

Average30=[25	25	7.00
25	30	2.40
25	40	3.00
25	47	2.20
25	63	1.80
25	71	1.60
30	30	7.00
30	40	3.20
30	47	2.20
30	63	2.00
30	71	1.80
40	40	7.00
40	47	2.60
40	63	2.20
40	71	1.40
47	47	7.00
47	63	3.20
47	71	3.20
63	63	7.00
63	71	2.20
71	71	7.00]

Average60=[25	25	7.00
25	30	2.40
25	40	2.20
25	47	2.20
25	63	2.40
25	71	1.60
30	30	7.00
30	40	3.00
30	47	2.40
30	63	2.20
30	71	2.20
40	40	7.00
40	47	2.00
40	63	2.60
40	71	1.40
47	47	7.00
47	63	3.20
47	71	2.00
63	63	7.00
63	71	1.60
71	71	7.00]

Average90=[25	25	7.00
25	30	2.20
25	40	2.20
25	47	2.60
25	63	2.80
25	71	2.00
30	30	7.00
30	40	3.40
30	47	2.20
30	63	2.20
30	71	1.80
40	40	7.00
40	47	2.20
40	63	1.80
40	71	1.60
47	47	7.00
47	63	2.00
47	71	1.40
63	63	7.00
63	71	2.20
71	71	7.00]



Tania0 = [25	25	7
25	30	2
25	40	4
25	47	4
25	63	2
25	71	2
30	30	7
30	40	4
30	47	4
30	63	2
30	71	1
40	40	7
40	47	4
40	63	3
40	71	1
47	47	7
47	63	3
47	71	2
63	63	7
63	71	1
71	71	7]

Tania30=[25	25	7.00
25	30	3.00
25	40	4.00
25	47	4.00
25	63	3.00
25	71	2.00
30	30	7.00
30	40	5.00
30	47	3.00
30	63	2.00
30	71	2.00
40	40	7.00
40	47	4.00
40	63	2.00
40	71	1.00
47	47	7.00
47	63	3.00
47	71	2.00
63	63	7.00
63	71	2.00
71	71	7.00]
Tania60=[25	25	7.00
25	30	4.00
25	40	3.00
25	47	4.00
25	63	3.00
25	71	2.00
30	30	7.00
30	40	4.00
30	47	4.00
30	63	2.00
30	71	1.00
40	40	7.00
40	47	3.00
40	63	2.00
40	71	1.00
47	47	7.00
47	63	3.00
47	71	2.00
63	63	7.00
63	71	1.00
71	71	7.00]
Tania90=[25	25	7.00
25	30	3.00
25	40	3.00
25	47	4.00
25	63	3.00
25	71	2.00
30	30	7.00
30	40	4.00
30	47	3.00
30	63	2.00
30	71	1.00
40	40	7.00
40	47	3.00
40	63	2.00
40	71	1.00
47	47	7.00
47	63	1.00
47	71	1.00
63	63	7.00
63	71	2.00
71	71	7.00]

% Number of subjects.
subjects = 2;

% Put subject matrix names into a cell structure.
% create cell array
ratings = cell(subjects,1);

%fill it
% ratings{1}=Jayne0;
% ratings{2}=Jayne30;
% ratings{3}=Jayne60;
% ratings{4}=Jayne90;

% ratings{1} =Minkyung0;
% ratings{2}=Minkyung30;
% ratings{3}=Minkyung60;
% ratings{4}=Minkyung90;

ratings{1} =Average0;
ratings{2}=Average30;
% ratings{3}=Average60;
% ratings{4}=Average90;

% ratings{1} =Omo0;
% ratings{2}=Omo30;
% ratings{3}=Omo60;
% ratings{4}=Omo90;
% 
% ratings{1} =Tania0;
% ratings{2}=Tania30;
% ratings{3}=Tania60;
% ratings{4}=Tania90;

% ratings{1} = Elena0;
% ratings{2}=Elena30;
% ratings{3}=Elena60;
% ratings{4}=Elena90;

% ratings{2} = Erika0;
% ratings{3} = Jayne0;
% ratings{4} = Minkyung0;
% ratings{5} = Omo0;
% ratings{6} = Tania0;

% Replace NaN ratings with the mean similarity rating for that subject.
%for subject = 1:subjects
 %   inds = find(isnan(ratings{subject}(:,3)));
  %  ratings{subject}(inds,3) = nanmean(ratings{subject}(:,3));    
%end

% Get id values for the face numbers.
ids = unique(Elena0(:,1));
%add second column which is counter (i.e. 1 to number of unique faces)
ids = [ids [1:length(ids)]'];

% Construct similarity matrices.
% Make cell array for similarities
similarities = cell(subjects,1);
%Make cell array for distances
distances = cell(subjects,1);


all_sims = [];


for subject = 1:subjects
    %makes square matrix of size n x n where n is the number of unique
    %faces
    sims = zeros(length(ids),length(ids));

    %get data for 1 subject
    data = ratings{subject};
    %number of rows and columns
    [di dj] = size(data);
    
    %go to each row
    for i = 1:di
        %fill sims array (like an xcel pivot table)
        %basically for a given row in the data file, want to find the
        %corresponding point in the nxn matrix where the rating goes
       
        %ids has two columns,ids(:,1) has original face database numbers
        %ids(:,2) has new numbering from 1 to the number of unique faces
        %data(:,1) has face1, data(:,2) has face2, data(:,3) has rating
        %set first row
        %find row of ids in which face1 is equal to shown face1
        %then find row of ids in which face is equal to shown face2
        %this gives you sims(face1, face2) which is set equal to the rating
        
        sims(find(ids(:,1)==data(i,1)),find(ids(:,1)==data(i,2))) = data(i,3);
    end

    % Draw histograms of similarity ratings.
    %figure(subject);
    %hist(sims(:),6);
    
    % Record ratings.
    %nice trick, takes whatever matrix is all_sims and adds one additional
    %column, allows for continual expansion
    %in this case each column is one subjects ratings
    all_sims = [all_sims sims(:)]; 
    
    % Turn similarities into distances.
    dists = 7 - sims;  %rating is from 1 to 7
    dists = triu(dists) + triu(dists)';
    distances{subject} = dists;
end

% Output correlation matrix for subjects' ratings.
%i.e. how correlated subjects are with one another
SubjectsR = corrcoef(all_sims)

% Calculate mean distance matrix.
% make empty square matrix
sum_distance_matrix = zeros(length(ids));
%sum each subject's data
for subject = 1:subjects
    sum_distance_matrix = sum_distance_matrix + distances{subject};
end
%divide by number of subjects
mean_distance_matrix = sum_distance_matrix ./ subjects;

%cheat to set diagonal values to zero (i.e. distance between identical
%items)
for i=1:size(max(ids))
    mean_distance_matrix(i,i)=0
end

 

% Get scaling solution for mean distance matrix.
opts = statset('MaxIter',2000)
[mean_mds_solution,stress,disparities] = mdscale(mean_distance_matrix,2,'Criterion','stress','Options',opts);

% [mean_mds_solution,stress,disparities] = mdscale(mean_distance_matrix,2,'Criterion','stress');

% Load face images.
%gives you a cell array with each element corresponding to a picture of a
%face

faces = cell(1,length(ids));
for ctr = 1:length(ids)
    file = [num2str(ids(ctr,1)) '.jpg']
    faces{ctr} = imread(file);
end

%to plot any face
%imagecs(face{n}); colormap gray;

% Some plotting parameters.
imsize = 0.4;
fig_posn = [0 0 1000 1000];

% Plot overall solution.
F=figure(5);

%mean_mds_solution is a list of x,y positions
%image is a function which places the center of an matrix  
%image[(x of first face in mds - konst; x of first face in mds +
%konst)], [yo face1 in mds -konst; y of face1 in mds+konst], face1

%so image([left, right],[top, bottom], picture)

%plot first face
image([mean_mds_solution(1,1)-imsize; mean_mds_solution(1,1)+imsize],[mean_mds_solution(1,2)-imsize; mean_mds_solution(1,2)+imsize],faces{1});
hold on;

%now the rest
for ctr = 2:length(ids)
   image([mean_mds_solution(ctr,1)-imsize; mean_mds_solution(ctr,1)+imsize],[mean_mds_solution(ctr,2)-imsize; mean_mds_solution(ctr,2)+imsize],faces{ctr}); 
end

text(mean_mds_solution(:,1),mean_mds_solution(:,2),num2str([1:6]'),'Color',[1 1 0], 'FontSize',18);




%find how big the plot needs to be
min_x = min(mean_mds_solution(:,1));
max_x = max(mean_mds_solution(:,1));
min_y = min(mean_mds_solution(:,2));
max_y = max(mean_mds_solution(:,2));

vals = abs([min_x max_x min_y max_y]);

%largest distance + some wiggle room
val = max(vals) + imsize;
%set axes
axis([-val val -val val]);
colormap([[0:1/255:1]', [0:1/255:1]',[0:1/255:1]'])
set(F,'Position',fig_posn);
hold off;

% Get solutions for each subject.
mds_solutions = cell(subjects,1);
for subject = 1:subjects
    % Set distance matrix.
    subject_distances = distances{subject};
    % Get MDS solution.
    opts = statset('MaxIter',5000)

    [mds_dimensions,stress,disparities] = mdscale(subject_distances,2,'Criterion','stress','Options',opts);
    % Store solution.
    mds_solutions{subject} = mds_dimensions;
end

% Go through solutions and find Procrustes transform to fit everything to mean solution as best as possible.
transformed_solutions = cell(subjects,1);
for subject = 1:subjects
    [error,rotated_subject_solution] = procrustes(mean_mds_solution,mds_solutions{subject});
    transformed_solutions{subject} = rotated_subject_solution;
end

% For each face, find the bounding co-ordinates.
bounds = cell(6,1);
for face = 1:6
    % Initialize bound to data from the first subject.
    face_loc = transformed_solutions{1}(face,:);
    bound = [face_loc(1) face_loc(1) face_loc(2) face_loc(2)];
    for subject = 1:subjects
        face_pt = transformed_solutions{subject}(face,:);
        if face_pt(1) < bound(1)
            bound(1) = face_pt(1);
        end
        if face_pt(1) > bound(2)
            bound(2) = face_pt(1);
        end
        if face_pt(2) < bound(3)
            bound(3) = face_pt(2);
        end
        if face_pt(2) > bound(4)
            bound(4) = face_pt(2);
        end
    end
    bounds{face} = bound;
end

% Plot all transformed solutions.
figure(11);
set(text, 'FontSize',18)
text(transformed_solutions{1}(:,1),transformed_solutions{1}(:,2),num2str([1:6]'),'Color','black', 'FontSize',18);
hold on;
text(transformed_solutions{2}(:,1),transformed_solutions{2}(:,2),num2str([1:6]'),'Color','blue', 'FontSize',18);
text(transformed_solutions{3}(:,1),transformed_solutions{3}(:,2),num2str([1:6]'),'Color','red', 'FontSize',18);
text(transformed_solutions{4}(:,1),transformed_solutions{4}(:,2),num2str([1:6]'),'Color','green', 'FontSize',18);
% text(transformed_solutions{5}(:,1),transformed_solutions{4}(:,2),num2str([1:6]'),'Color','yellow');
% text(transformed_solutions{4}(:,1),transformed_solutions{4}(:,2),num2str([1:6]'),'Color',[.50,.50,.50]);

axis([-4 4 -4 4]);
% Plot bounding rectangles.
for face = 1:length(ids)
    bound = bounds{face};
    H=fill([bound(1) bound(1) bound(2) bound(2)],[bound(3) bound(4) bound(4) bound(3)],[0 0 0]);
    set(H,'EdgeColor',[1 1 1]);
    set(H,'EdgeAlpha',0);
end
alpha(0.05);
hold off;



%for all views diagram (i.e. for seeing all views for a single subject on
%one plot
figure(12)

%load all views
all_ids = unique(ElenaAll(:,1));
%need to sort these from 6 groups of 4 to 4 groups of 6

all_ids = reshape(all_ids, 2,6)
all_ids=all_ids'
all_ids = reshape(all_ids, 12, 1)

allfaces = cell(1,max(size(all_ids)));
for ctr = 1:max(size((all_ids)))
    file = [num2str(all_ids(ctr,1)) '.jpg']
    allfaces{ctr} = imread(file);
end


%combine seperate points into single array
imsize = 0.3;

ts = transformed_solutions;
all_sol=[];
for i=1:subjects
    all_sol=[all_sol;ts{i}]
end

all_sol = [all_sol(:,1) -1*all_sol(:,2)]
%plot first face
image([all_sol(1,1)-imsize; all_sol(1,1)+imsize],[all_sol(1,2)-imsize; all_sol(1,2)+imsize],allfaces{1});
hold on;

%now the rest
for ctr = 2:length(allfaces)
   image([all_sol(ctr,1)-imsize;all_sol(ctr,1)+imsize],[all_sol(ctr,2)-imsize; all_sol(ctr,2)+imsize],allfaces{ctr}); 
end
%find how big the plot needs to be
min_x = min(all_sol(:,1));
max_x = max(all_sol(:,1));
min_y = min(all_sol(:,2));
max_y = max(all_sol(:,2));

vals = abs([min_x max_x min_y max_y]);
axis equal

hold on;
set(text, 'FontSize',18)
text(transformed_solutions{1}(:,1),transformed_solutions{1}(:,2)*-1,num2str([1:6]'),'Color','black', 'FontSize',18);
text(transformed_solutions{2}(:,1),transformed_solutions{2}(:,2)*-1,num2str([1:6]'),'Color','blue', 'FontSize',18);
text(transformed_solutions{3}(:,1),transformed_solutions{3}(:,2)*-1,num2str([1:6]'),'Color','red', 'FontSize',18);
text(transformed_solutions{4}(:,1),transformed_solutions{4}(:,2)*-1,num2str([1:6]'),'Color','green', 'FontSize',18);

%largest distance + some wiggle room
val = max(vals);
%set axes
axis([-val val -val val]);
axis equal
colormap([[0:1/255:1]', [0:1/255:1]',[0:1/255:1]'])
% set(F,'Position',fig_posn);
% hold off;
% axis([-3 3 -3 3]);
% % Plot bounding rectangles.
% for face = 1:length(ids)
%     bound = bounds{face};
%     H=fill([bound(1) bound(1) bound(2) bound(2)],[bound(3) bound(4) bound(4) bound(3)],[0 0 0]);
%     set(H,'EdgeColor',[1 1 1]);
%     set(H,'EdgeAlpha',0);
% end
% alpha(0.05);
% hold off;



% % Plot subject solution.
% figure(subject+5);
% image([mds_dimensions(1,1)-imsize; mds_dimensions(1,1)+imsize],[mds_dimensions(1,2)-imsize; mds_dimensions(1,2)+imsize],faces{1});
% hold on;
% for ctr = 2:20
%     image([mds_dimensions(ctr,1)-imsize; mds_dimensions(ctr,1)+imsize],[mds_dimensions(ctr,2)-imsize; mds_dimensions(ctr,2)+imsize],faces{ctr});
% end
% min_x = min(mds_dimensions(:,1));
% max_x = max(mds_dimensions(:,1));
% min_y = min(mds_dimensions(:,2));
% max_y = max(mds_dimensions(:,2));
% vals = abs([min_x max_x min_y max_y]);
% val = max(vals) + imsize;
% axis([-val val -val val]);
% set(F,'Position',fig_posn);
% title_str = ['Subject ' num2str(subject)];
% title(title_str);
% hold off;

